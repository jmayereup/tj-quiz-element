<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Parsing</title>
</head>
<body>

<div id="debug-output"></div>

<script>
// Copy the exact parsing function from tj-quiz-element.js
function parseQuestions(questionsSection, maxQuestions = null) {
    if (!questionsSection) return [];
    
    const lines = questionsSection.split('\n').map(l => l.trim()).filter(l => l.length > 0);
    let currentQuestion = null;
    const tempQuestionBank = [];
    
    console.log('Lines to parse:', lines);
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        console.log(`Line ${i}: "${line}"`);
        
        if (line.startsWith('Q:') || line.startsWith('Q.')) {
            console.log('Found question start');
            // New question
            if (currentQuestion) {
                console.log('Pushing previous question:', currentQuestion);
                tempQuestionBank.push(currentQuestion);
            }
            currentQuestion = {
                q: line.substring(2).trim(),
                o: [],
                a: '',
                e: '' // explanation
            };
            console.log('Created new question:', currentQuestion.q);
        } else if (line.startsWith('A:') && currentQuestion) {
            console.log('Found answer option');
            // Answer option
            const answerText = line.substring(2).trim();
            const isCorrect = answerText.includes('[correct]');
            const cleanAnswer = answerText.replace('[correct]', '').trim();
            
            currentQuestion.o.push(cleanAnswer);
            if (isCorrect) {
                currentQuestion.a = cleanAnswer;
            }
            console.log('Added answer:', cleanAnswer, 'Correct:', isCorrect);
        } else if (line.startsWith('E:') && currentQuestion) {
            // Explanation
            currentQuestion.e = line.substring(2).trim();
            console.log('Added explanation:', currentQuestion.e);
        } else {
            console.log('Unrecognized line format');
        }
    }
    
    // Don't forget the last question
    if (currentQuestion) {
        console.log('Pushing final question:', currentQuestion);
        tempQuestionBank.push(currentQuestion);
    }
    
    console.log('Total questions parsed:', tempQuestionBank.length);
    return tempQuestionBank;
}

// Test with your content
const testContent = `Q: I go to bed at 10 PM every single night. I ______ go to bed late.
A: sometimes
A: never [correct]
A: often

Q: The sun ______ rises in the east. It's a fact of nature.
A: always [correct]
A: rarely
A: sometimes

Q: He is a vegetarian, so he ______ eats meat.
A: often
A: never [correct]
A: usually

Q: She loves movies. She ______ goes to the cinema, maybe three times a month.
A: often [correct]
A: never
A: rarely

Q: We ______ have a test on Fridays, but not every single Friday.
A: usually [correct]
A: always
A: never

Q: "Do you exercise?" "Yes, I ______ go for a run in the morning. It's part of my normal routine."
A: hardly ever
A: normally [correct]
A: never

Q: I'm not a big fan of spicy food. I ______ eat it, but only on special occasions.
A: always
A: occasionally [correct]
A: usually

Q: "Do you walk to work?" "______, but only when the weather is nice."
A: Never
A: Always
A: Sometimes [correct]

Q: He's afraid of flying, so he ______ travels by plane.
A: seldom [correct]
A: always
A: often

Q. The desert is very dry. It ______ rains there.
A: often
A: rarely [correct]
A: always

Q: She is very busy and ______ has free time to relax.
A: usually
A: hardly ever [correct]
A: always

Q: Which sentence is correct?
A: I go always to the park.
A: I always go to the park. [correct]
A: I go to the park always.

Q: He is ______ happy to help his friends. He is a very kind person.
A: always [correct]
A: never
A: rarely

Q: Which sentence is correct?
A: She is often late. [correct]
A: She often is late.
A: She is late often.

Q: I ______ forget to do my homework because I write it down in my notebook.
A: never [correct]
A: sometimes
A: always`;

console.log('Starting parse test...');
const questions = parseQuestions(testContent);

const debugOutput = document.getElementById('debug-output');
debugOutput.innerHTML = '<h2>Parsed Questions:</h2>';

questions.forEach((q, index) => {
    debugOutput.innerHTML += `
        <div style="border: 1px solid #ccc; margin: 10px; padding: 10px;">
            <h3>Question ${index + 1}:</h3>
            <p><strong>Q:</strong> ${q.q}</p>
            <p><strong>Options:</strong> ${q.o.join(', ')}</p>
            <p><strong>Correct Answer:</strong> ${q.a}</p>
            <p><strong>Explanation:</strong> ${q.e}</p>
        </div>
    `;
});
</script>

</body>
</html>
</script>

</body>
</html>
